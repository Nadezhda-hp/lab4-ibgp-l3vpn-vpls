# Лабораторная работа №4

## Эмуляция распределённой корпоративной сети связи, настройка iBGP, организация L3VPN и VPLS

> Университет ИТМО | Факультет инфокоммуникационных технологий | Введение в маршрутизацию

---

### Описание

Компания "RogaIKopita Games" выпустила игру "Allmoney Impact". Нагрузка возросла, и нужно организовать собственную автономную систему (AS 65530). Коллеги из отдела DEVOPS попросили организовать VPN между тремя офисами. Работа состоит из двух частей:

1. **L3VPN** — виртуальная сеть уровня L3 (каждый офис в своей подсети)
2. **VPLS** — виртуальная сеть уровня L2 (все офисы в одной подсети)

### Схема сети

```
PC2 ─── R01.NY ─── R01.LND ──── R01.HKI ─── R01.SPB ─── PC1
                      |    \      /    |
                      |    R01.LBN     |
                      |       |
                      |    R01.SVL
                      |       |
                      |     PC3

Роли:
  PE: R01.NY, R01.SPB, R01.SVL     (клиентские подключения)
  P:  R01.LBN                       (транзит)
  RR: R01.LND, R01.HKI             (Route Reflector)
```

### Технологии

| Технология | Назначение |
|------------|-----------|
| OSPF | Базовая маршрутизация, связность loopback-адресов |
| MPLS + LDP | Транспорт для VPN-трафика |
| iBGP | Распространение VPN-маршрутов (address-family vpnv4) |
| Route Reflector | Устранение необходимости full-mesh iBGP |
| L3VPN (VRF) | Изолированная виртуальная сеть уровня L3 |
| VPLS | Виртуальный L2-коммутатор через MPLS |
| ContainerLab | Эмуляция сетевой топологии |
| MikroTik RouterOS (CHR) | Операционная система роутеров |

### IP-адресация

| Роутер | Loopback | Роль |
|--------|----------|------|
| R01.NY | 10.10.10.1/32 | PE |
| R01.LND | 10.10.10.2/32 | RR |
| R01.LBN | 10.10.10.3/32 | P |
| R01.HKI | 10.10.10.4/32 | RR |
| R01.SPB | 10.10.10.5/32 | PE |
| R01.SVL | 10.10.10.6/32 | PE |

**L3VPN (VRF\_DEVOPS):** RD 65530:100, RT 65530:100

| PE | Подсеть VRF | ПК |
|----|-------------|-----|
| R01.NY | 192.168.10.0/24 | PC2 |
| R01.SPB | 192.168.20.0/24 | PC1 |
| R01.SVL | 192.168.30.0/24 | PC3 |

**VPLS:** все ПК в подсети 192.168.100.0/24

### Структура репозитория

```
├── lab4.yaml              # Топология ContainerLab
├── R01_NY.rsc             # Конфигурация роутера Нью-Йорк (PE)
├── R01_LND.rsc            # Конфигурация роутера Лондон (RR)
├── R01_LBN.rsc            # Конфигурация роутера Любляна (P)
├── R01_HKI.rsc            # Конфигурация роутера Хельсинки (RR)
├── R01_SPB.rsc            # Конфигурация роутера Санкт-Петербург (PE)
├── R01_SVL.rsc            # Конфигурация роутера Сан-Вали (PE)
├── lab4_report.md         # Отчёт с результатами
├── lab4_network_diagram.png   # Схема сети
└── lab4_ping_routes.png       # Результаты проверки связности
```

### Запуск

```bash
cd lab4
sudo containerlab deploy --topo lab4.yaml
```

### Результат

**Часть 1 — L3VPN:**
- Все OSPF-соседства **Full**, BGP-сессии **established**
- VRF-маршруты корректно распространяются через BGP
- Пинг между всеми ПК DEVOPS — 0% потерь, TTL=61

**Часть 2 — VPLS:**
- Все ПК в единой L2-сети 192.168.100.0/24
- Пинг между всеми ПК — 0% потерь, TTL=64 (L2-коммутация)
